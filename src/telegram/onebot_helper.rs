use anyhow::Result;
use grammers_tl_types::enums::InputGeoPoint;
use grammers_tl_types::types::InputMediaVenue;
use image::GenericImageView;
use phf::phf_map;
use serde_json::Value;
use serde_json_path::JsonPath;
use tempfile::NamedTempFile;
use tokio::process::Command;
use webp::Encoder;

use crate::onebot::protocol::segment::Segment;

pub fn is_sticker(segment: &Segment) -> bool {
    match segment {
        Segment::MarketFace(_) => true,
        Segment::Image(image) => match image.emoji_id {
            Some(_) => true,
            None => image
                .summary
                .as_ref()
                .is_some_and(|summary| summary.as_str() == "[åŠ¨ç”»è¡¨æƒ…]"),
        },
        _ => false,
    }
}

pub fn image_size(image_data: &[u8], mime_type: &str) -> (u32, u32) {
    if mime_type.starts_with("image") {
        if let Ok(img) = image::load_from_memory(image_data) {
            return img.dimensions();
        }
    }

    (0, 0)
}

pub fn img_to_webp(image_data: &[u8]) -> Result<Vec<u8>> {
    let img = image::load_from_memory(image_data)?;
    let (width, height) = img.dimensions();
    let quality = 85.0;

    let webp_data = if img.color().has_alpha() {
        let rgba = img.to_rgba8();
        Encoder::from_rgba(rgba.as_raw(), width, height)
            .encode(quality)
            .to_vec()
    } else {
        let rgb = img.to_rgb8();
        Encoder::from_rgb(rgb.as_raw(), width, height)
            .encode(quality)
            .to_vec()
    };

    Ok(webp_data.to_vec())
}

pub async fn gif_to_webm(input_data: &[u8]) -> Result<Vec<u8>> {
    // åˆ›å»ºä¸´æ—¶æ–‡ä»¶ (é€šè¿‡ç®¡é“ä½œä¸ºè¾“å…¥åªèƒ½é¡ºåºè®¿é—®, åœ¨è½¬æ¢æ—¶å®¹æ˜“å‡ºçŽ°é—®é¢˜)
    let temp_file = NamedTempFile::new()?;
    let input_path = temp_file
        .path()
        .to_str()
        .ok_or_else(|| anyhow::anyhow!("Invalid temp path"))?;

    // å°†è¾“å…¥æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶
    tokio::fs::write(input_path, input_data).await?;

    let child = Command::new("ffmpeg")
        .args([
            "-i",
            input_path,
            "-r",
            "30",
            "-t",
            "2.99",
            "-an",
            "-c:v",
            "libvpx-vp9",
            "-pix_fmt",
            "yuva420p",
            "-vf",
            "''scale=512:512:force_original_aspect_ratio=decrease'",
            "-b:v",
            "400K",
            "-f",
            "webm",
            "pipe:1",
        ])
        .stdout(std::process::Stdio::piped())
        .stderr(std::process::Stdio::inherit())
        .spawn()?;

    let output = child.wait_with_output().await?;
    if !output.status.success() {
        return Err(anyhow::anyhow!("ffmpeg exited: {}", output.status));
    }

    Ok(output.stdout)
}

pub async fn wav_to_ogg(input_data: &[u8]) -> Result<Vec<u8>> {
    // åˆ›å»ºä¸´æ—¶æ–‡ä»¶ (é€šè¿‡ç®¡é“ä½œä¸ºè¾“å…¥åªèƒ½é¡ºåºè®¿é—®, åœ¨è½¬æ¢æ—¶å®¹æ˜“å‡ºçŽ°é—®é¢˜)
    let temp_file = NamedTempFile::new()?;
    let input_path = temp_file
        .path()
        .to_str()
        .ok_or_else(|| anyhow::anyhow!("Invalid temp path"))?;

    // å°†è¾“å…¥æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶
    tokio::fs::write(input_path, input_data).await?;

    let child = Command::new("ffmpeg")
        .args([
            "-i", input_path, "-c:a", "libopus", "-b:a", "24K", "-f", "ogg", "pipe:1",
        ])
        .stdout(std::process::Stdio::piped())
        .stderr(std::process::Stdio::inherit())
        .spawn()?;

    let output = child.wait_with_output().await?;
    if !output.status.success() {
        return Err(anyhow::anyhow!("ffmpeg exited: {}", output.status));
    }

    Ok(output.stdout)
}

pub fn extract_location_from_json(json: &Value) -> Result<InputMediaVenue> {
    let title = JsonPath::parse("$.meta.*.name")?
        .query(json)
        .exactly_one()
        .map(|v| v.as_str().unwrap())?
        .to_string();
    let address = JsonPath::parse("$.meta.*.address")?
        .query(json)
        .exactly_one()
        .map(|v| v.as_str().unwrap())?
        .to_string();
    let lat = JsonPath::parse("$.meta.*.lat")?
        .query(json)
        .exactly_one()
        .map(|v| v.as_str().unwrap().parse::<f64>().unwrap())?;
    let long = JsonPath::parse("$.meta.*.lng")?
        .query(json)
        .exactly_one()
        .map(|v| v.as_str().unwrap().parse::<f64>().unwrap())?;

    Ok(InputMediaVenue {
        geo_point: InputGeoPoint::Point(grammers_tl_types::types::InputGeoPoint {
            lat,
            long,
            accuracy_radius: None,
        }),
        title,
        address,
        provider: String::new(),
        venue_id: String::new(),
        venue_type: String::new(),
    })
}

pub fn extract_share_from_json(json: &Value) -> Result<String> {
    let (title, description, source, url);

    let doc_node = JsonPath::parse("$.meta.*.qqdocurl")?.query(json);
    if doc_node.is_empty() {
        let jump_node = JsonPath::parse("$.meta.*.jumpUrl")?.query(json);
        if jump_node.is_empty() {
            return Ok(String::new());
        } else {
            url = jump_node.exactly_one().map(|v| v.as_str().unwrap())?;
            source = JsonPath::parse("$.meta.*.tag")?
                .query(json)
                .exactly_one()
                .map(|v| v.as_str().unwrap())?;
            description = JsonPath::parse("$.meta.*.desc")?
                .query(json)
                .exactly_one()
                .map(|v| v.as_str().unwrap())?;
            title = JsonPath::parse("$.prompt")?
                .query(json)
                .exactly_one()
                .map(|v| v.as_str().unwrap())?;
        }
    } else {
        url = doc_node.exactly_one().map(|v| v.as_str().unwrap())?;
        source = JsonPath::parse("$.meta.*.title")?
            .query(json)
            .exactly_one()
            .map(|v| v.as_str().unwrap())?;
        description = JsonPath::parse("$.meta.*.desc")?
            .query(json)
            .exactly_one()
            .map(|v| v.as_str().unwrap())?;
        title = JsonPath::parse("$.prompt")?
            .query(json)
            .exactly_one()
            .map(|v| v.as_str().unwrap())?;
    }

    Ok(format!(
        "<u>{}</u>\n\n{}\n\nvia <a href=\"{}\">{}</a>",
        html_escape::encode_text(title),
        html_escape::encode_text(description),
        html_escape::encode_text(url),
        html_escape::encode_text(source),
    ))
}

static QQ_EMOJI: phf::Map<&'static str, &'static str> = phf_map! {
    "0" => "æƒŠè®¶",
    "1" => "æ’‡å˜´",
    "2" => "è‰²",
    "3" => "å‘å‘†",
    "4" => "å¾—æ„",
    "5" => "æµæ³ª",
    "6" => "å®³ç¾ž",
    "7" => "é—­å˜´",
    "8" => "ç¡",
    "9" => "å¤§å“­",
    "10" => "å°´å°¬",
    "11" => "å‘æ€’",
    "12" => "è°ƒçš®",
    "13" => "å‘²ç‰™",
    "14" => "å¾®ç¬‘",
    "15" => "éš¾è¿‡",
    "16" => "é…·",
    "18" => "æŠ“ç‹‚",
    "19" => "å",
    "20" => "å·ç¬‘",
    "21" => "å¯çˆ±",
    "22" => "ç™½çœ¼",
    "23" => "å‚²æ…¢",
    "24" => "é¥¥é¥¿",
    "25" => "å›°",
    "26" => "æƒŠæ",
    "27" => "æµæ±—",
    "28" => "æ†¨ç¬‘",
    "29" => "æ‚ é—²",
    "30" => "å¥‹æ–—",
    "31" => "å’’éª‚",
    "32" => "ç–‘é—®",
    "33" => "å˜˜",
    "34" => "æ™•",
    "35" => "æŠ˜ç£¨",
    "36" => "è¡°",
    "37" => "éª·é«…",
    "38" => "æ•²æ‰“",
    "39" => "å†è§",
    "41" => "å‘æŠ–",
    "42" => "çˆ±æƒ…",
    "43" => "è·³è·³",
    "46" => "çŒªå¤´",
    "49" => "æ‹¥æŠ±",
    "53" => "è›‹ç³•",
    "54" => "é—ªç”µ",
    "55" => "ç‚¸å¼¹",
    "56" => "åˆ€",
    "57" => "è¶³çƒ",
    "59" => "ä¾¿ä¾¿",
    "60" => "å’–å•¡",
    "61" => "é¥­",
    "63" => "çŽ«ç‘°",
    "64" => "å‡‹è°¢",
    "66" => "çˆ±å¿ƒ",
    "67" => "å¿ƒç¢Ž",
    "69" => "ç¤¼ç‰©",
    "74" => "å¤ªé˜³",
    "75" => "æœˆäº®",
    "76" => "èµž",
    "77" => "è¸©",
    "78" => "æ¡æ‰‹",
    "79" => "èƒœåˆ©",
    "85" => "é£žå»",
    "86" => "æ€„ç«",
    "89" => "è¥¿ç“œ",
    "96" => "å†·æ±—",
    "97" => "æ“¦æ±—",
    "98" => "æŠ é¼»",
    "99" => "é¼“æŽŒ",
    "100" => "ç³—å¤§äº†",
    "101" => "åç¬‘",
    "102" => "å·¦å“¼å“¼",
    "103" => "å³å“¼å“¼",
    "104" => "å“ˆæ¬ ",
    "105" => "é„™è§†",
    "106" => "å§”å±ˆ",
    "107" => "å¿«å“­äº†",
    "108" => "é˜´é™©",
    "109" => "å·¦äº²äº²",
    "110" => "å“",
    "111" => "å¯æ€œ",
    "112" => "èœåˆ€",
    "113" => "å•¤é…’",
    "114" => "ç¯®çƒ",
    "115" => "ä¹’ä¹“",
    "116" => "ç¤ºçˆ±",
    "117" => "ç“¢è™«",
    "118" => "æŠ±æ‹³",
    "119" => "å‹¾å¼•",
    "120" => "æ‹³å¤´",
    "121" => "å·®åŠ²",
    "122" => "çˆ±ä½ ",
    "123" => "NO",
    "124" => "OK",
    "125" => "è½¬åœˆ",
    "126" => "ç£•å¤´",
    "127" => "å›žå¤´",
    "128" => "è·³ç»³",
    "129" => "æŒ¥æ‰‹",
    "130" => "æ¿€åŠ¨",
    "131" => "è¡—èˆž",
    "132" => "çŒ®å»",
    "133" => "å·¦å¤ªæž",
    "134" => "å³å¤ªæž",
    "136" => "åŒå–œ",
    "137" => "éž­ç‚®",
    "138" => "ç¯ç¬¼",
    "140" => "Kæ­Œ",
    "144" => "å–å½©",
    "145" => "ç¥ˆç¥·",
    "146" => "çˆ†ç­‹",
    "147" => "æ£’æ£’ç³–",
    "148" => "å–å¥¶",
    "151" => "é£žæœº",
    "158" => "é’žç¥¨",
    "168" => "è¯",
    "169" => "æ‰‹æžª",
    "171" => "èŒ¶",
    "172" => "çœ¨çœ¼ç›",
    "173" => "æ³ªå¥”",
    "174" => "æ— å¥ˆ",
    "175" => "å–èŒ",
    "176" => "å°çº ç»“",
    "177" => "å–·è¡€",
    "178" => "æ–œçœ¼ç¬‘",
    "179" => "doge",
    "180" => "æƒŠå–œ",
    "181" => "éªšæ‰°",
    "182" => "ç¬‘å“­",
    "183" => "æˆ‘æœ€ç¾Ž",
    "184" => "æ²³èŸ¹",
    "185" => "ç¾Šé©¼",
    "187" => "å¹½çµ",
    "188" => "è›‹",
    "190" => "èŠèŠ±",
    "192" => "çº¢åŒ…",
    "193" => "å¤§ç¬‘",
    "194" => "ä¸å¼€å¿ƒ",
    "197" => "å†·æ¼ ",
    "198" => "å‘ƒ",
    "199" => "å¥½æ£’",
    "200" => "æ‹œæ‰˜",
    "201" => "ç‚¹èµž",
    "202" => "æ— èŠ",
    "203" => "æ‰˜è„¸",
    "204" => "åƒ",
    "205" => "é€èŠ±",
    "206" => "å®³æ€•",
    "207" => "èŠ±ç—´",
    "208" => "å°æ ·å„¿",
    "210" => "é£™æ³ª",
    "211" => "æˆ‘ä¸çœ‹",
    "212" => "æ‰˜è…®",
    "214" => "å•µå•µ",
    "215" => "ç³Šè„¸",
    "216" => "æ‹å¤´",
    "217" => "æ‰¯ä¸€æ‰¯",
    "218" => "èˆ”ä¸€èˆ”",
    "219" => "è¹­ä¸€è¹­",
    "220" => "æ‹½ç‚¸å¤©",
    "221" => "é¡¶å‘±å‘±",
    "222" => "æŠ±æŠ±",
    "223" => "æš´å‡»",
    "224" => "å¼€æžª",
    "225" => "æ’©ä¸€æ’©",
    "226" => "æ‹æ¡Œ",
    "227" => "æ‹æ‰‹",
    "228" => "æ­å–œ",
    "229" => "å¹²æ¯",
    "230" => "å˜²è®½",
    "231" => "å“¼",
    "232" => "ä½›ç³»",
    "233" => "æŽä¸€æŽ",
    "234" => "æƒŠå‘†",
    "235" => "é¢¤æŠ–",
    "236" => "å•ƒå¤´",
    "237" => "å·çœ‹",
    "238" => "æ‰‡è„¸",
    "239" => "åŽŸè°…",
    "240" => "å–·è„¸",
    "241" => "ç”Ÿæ—¥å¿«ä¹",
    "242" => "å¤´æ’žå‡»",
    "243" => "ç”©å¤´",
    "244" => "æ‰”ç‹—",
    "245" => "åŠ æ²¹å¿…èƒœ",
    "246" => "åŠ æ²¹æŠ±æŠ±",
    "247" => "å£ç½©æŠ¤ä½“",
    "260" => "æ¬ç –ä¸­",
    "261" => "å¿™åˆ°é£žèµ·",
    "262" => "è„‘é˜”ç–¼",
    "263" => "æ²§æ¡‘",
    "264" => "æ‚è„¸",
    "265" => "è¾£çœ¼ç›",
    "266" => "å“¦å“Ÿ",
    "267" => "å¤´ç§ƒ",
    "268" => "é—®å·è„¸",
    "269" => "æš—ä¸­è§‚å¯Ÿ",
    "270" => "emm",
    "271" => "åƒç“œ",
    "272" => "å‘µå‘µå“’",
    "273" => "æˆ‘é…¸äº†",
    "274" => "å¤ªå—äº†",
    "276" => "è¾£æ¤’é…±",
    "277" => "æ±ªæ±ª",
    "278" => "æ±—",
    "279" => "æ‰“è„¸",
    "280" => "å‡»æŽŒ",
    "281" => "æ— çœ¼ç¬‘",
    "282" => "æ•¬ç¤¼",
    "283" => "ç‹‚ç¬‘",
    "284" => "é¢æ— è¡¨æƒ…",
    "285" => "æ‘¸é±¼",
    "286" => "é­”é¬¼ç¬‘",
    "287" => "å“¦",
    "288" => "è¯·",
    "289" => "ççœ¼",
    "290" => "æ•²å¼€å¿ƒ",
    "291" => "éœ‡æƒŠ",
    "292" => "è®©æˆ‘åº·åº·",
    "293" => "æ‘¸é”¦é²¤",
    "294" => "æœŸå¾…",
    "295" => "æ‹¿åˆ°çº¢åŒ…",
    "296" => "çœŸå¥½",
    "297" => "æ‹œè°¢",
    "298" => "å…ƒå®",
    "299" => "ç‰›å•Š",
    "300" => "èƒ–ä¸‰æ–¤",
    "301" => "å¥½é—ª",
    "302" => "å·¦æ‹œå¹´",
    "303" => "å³æ‹œå¹´",
    "304" => "çº¢åŒ…åŒ…",
    "305" => "å³äº²äº²",
    "306" => "ç‰›æ°”å†²å¤©",
    "307" => "å–µå–µ",
    "308" => "æ±‚çº¢åŒ…",
    "309" => "è°¢çº¢åŒ…",
    "310" => "æ–°å¹´çƒŸèŠ±",
    "311" => "æ‰“call",
    "312" => "å˜å½¢",
    "313" => "å—‘åˆ°äº†",
    "314" => "ä»”ç»†åˆ†æž",
    "315" => "åŠ æ²¹",
    "316" => "æˆ‘æ²¡äº‹",
    "317" => "èœæ±ª",
    "318" => "å´‡æ‹œ",
    "319" => "æ¯”å¿ƒ",
    "320" => "åº†ç¥",
    "321" => "è€è‰²ç—ž",
    "322" => "æ‹’ç»",
    "323" => "å«Œå¼ƒ",
    "324" => "åƒç³–",
    "325" => "æƒŠå“",
    "326" => "ç”Ÿæ°”",
    "327" => "åŠ ä¸€",
    "328" => "é”™å·",
    "329" => "å¯¹å·",
    "330" => "å®Œæˆ",
    "331" => "æ˜Žç™½",
    "332" => "ä¸¾ç‰Œç‰Œ",
    "333" => "çƒŸèŠ±",
    "334" => "è™Žè™Žç”Ÿå¨",
    "336" => "è±¹å¯Œ",
    "337" => "èŠ±æœµè„¸",
    "338" => "æˆ‘æƒ³å¼€äº†",
    "339" => "èˆ”å±",
    "340" => "çƒ­åŒ–äº†",
    "341" => "æ‰“æ‹›å‘¼",
    "342" => "é…¸Q",
    "343" => "æˆ‘æ–¹äº†",
    "344" => "å¤§æ€¨ç§",
    "345" => "çº¢åŒ…å¤šå¤š",
    "346" => "ä½ çœŸæ£’æ£’",
    "347" => "å¤§å±•å®å…”",
    "348" => "ç¦èåœ",
};

const WECHAT_EMOJI_REPLACEMENTS: &[(&str, &str)] = &[
    ("[å¾®ç¬‘]", "ðŸ˜ƒ"),
    ("[Smile]", "ðŸ˜ƒ"),
    ("[è‰²]", "ðŸ˜"),
    ("[Drool]", "ðŸ˜"),
    ("[å‘å‘†]", "ðŸ˜³"),
    ("[Scowl]", "ðŸ˜³"),
    ("[å¾—æ„]", "ðŸ˜Ž"),
    ("[Chill]", "ðŸ˜Ž"),
    ("[æµæ³ª]", "ðŸ˜­"),
    ("[Sob]", "ðŸ˜­"),
    ("[å®³ç¾ž]", "â˜ºï¸"),
    ("[Shy]", "â˜ºï¸"),
    ("[é—­å˜´]", "ðŸ¤"),
    ("[Shutup]", "ðŸ¤"),
    ("[ç¡]", "ðŸ˜´"),
    ("[Sleep]", "ðŸ˜´"),
    ("[å¤§å“­]", "ðŸ˜£"),
    ("[Cry]", "ðŸ˜£"),
    ("[å°´å°¬]", "ðŸ˜°"),
    ("[Awkward]", "ðŸ˜°"),
    ("[å‘æ€’]", "ðŸ˜¡"),
    ("[Pout]", "ðŸ˜¡"),
    ("[è°ƒçš®]", "ðŸ˜œ"),
    ("[Wink]", "ðŸ˜œ"),
    ("[å‘²ç‰™]", "ðŸ˜"),
    ("[Grin]", "ðŸ˜"),
    ("[æƒŠè®¶]", "ðŸ˜±"),
    ("[Surprised]", "ðŸ˜±"),
    ("[éš¾è¿‡]", "ðŸ™"),
    ("[Frown]", "ðŸ™"),
    ("[å›§]", "â˜ºï¸"),
    ("[Tension]", "â˜ºï¸"),
    ("[æŠ“ç‹‚]", "ðŸ˜«"),
    ("[Scream]", "ðŸ˜«"),
    ("[å]", "ðŸ¤¢"),
    ("[Puke]", "ðŸ¤¢"),
    ("[å·ç¬‘]", "ðŸ™ˆ"),
    ("[Chuckle]", "ðŸ™ˆ"),
    ("[æ„‰å¿«]", "â˜ºï¸"),
    ("[Joyful]", "â˜ºï¸"),
    ("[ç™½çœ¼]", "ðŸ™„"),
    ("[Slight]", "ðŸ™„"),
    ("[å‚²æ…¢]", "ðŸ˜•"),
    ("[Smug]", "ðŸ˜•"),
    ("[å›°]", "ðŸ˜ª"),
    ("[Drowsy]", "ðŸ˜ª"),
    ("[æƒŠæ]", "ðŸ˜±"),
    ("[Panic]", "ðŸ˜±"),
    ("[æµæ±—]", "ðŸ˜“"),
    ("[Sweat]", "ðŸ˜“"),
    ("[æ†¨ç¬‘]", "ðŸ˜„"),
    ("[Laugh]", "ðŸ˜„"),
    ("[æ‚ é—²]", "ðŸ˜"),
    ("[Loafer]", "ðŸ˜"),
    ("[å¥‹æ–—]", "ðŸ’ª"),
    ("[Strive]", "ðŸ’ª"),
    ("[å’’éª‚]", "ðŸ˜¤"),
    ("[Scold]", "ðŸ˜¤"),
    ("[ç–‘é—®]", "â“"),
    ("[Doubt]", "â“"),
    ("[å˜˜]", "ðŸ¤"),
    ("[Shhh]", "ðŸ¤"),
    ("[æ™•]", "ðŸ˜²"),
    ("[Dizzy]", "ðŸ˜²"),
    ("[è¡°]", "ðŸ˜³"),
    ("[BadLuck]", "ðŸ˜³"),
    ("[éª·é«…]", "ðŸ’€"),
    ("[Skull]", "ðŸ’€"),
    ("[æ•²æ‰“]", "ðŸ‘Š"),
    ("[Hammer]", "ðŸ‘Š"),
    ("[å†è§]", "ðŸ™‹â™‚"),
    ("[Bye]", "ðŸ™‹â™‚"),
    ("[æ“¦æ±—]", "ðŸ˜¥"),
    ("[Relief]", "ðŸ˜¥"),
    ("[æŠ é¼»]", "ðŸ¤·â™‚"),
    ("[DigNose]", "ðŸ¤·â™‚"),
    ("[é¼“æŽŒ]", "ðŸ‘"),
    ("[Clap]", "ðŸ‘"),
    ("[åç¬‘]", "ðŸ‘»"),
    ("[Trick]", "ðŸ‘»"),
    ("[å·¦å“¼å“¼]", "ðŸ˜¾"),
    ("[Bahï¼L]", "ðŸ˜¾"),
    ("[å³å“¼å“¼]", "ðŸ˜¾"),
    ("[Bahï¼R]", "ðŸ˜¾"),
    ("[å“ˆæ¬ ]", "ðŸ˜ª"),
    ("[Yawn]", "ðŸ˜ª"),
    ("[é„™è§†]", "ðŸ˜’"),
    ("[Lookdown]", "ðŸ˜’"),
    ("[å§”å±ˆ]", "ðŸ˜£"),
    ("[Wronged]", "ðŸ˜£"),
    ("[å¿«å“­äº†]", "ðŸ˜”"),
    ("[Puling]", "ðŸ˜”"),
    ("[é˜´é™©]", "ðŸ˜ˆ"),
    ("[Sly]", "ðŸ˜ˆ"),
    ("[äº²äº²]", "ðŸ˜˜"),
    ("[Kiss]", "ðŸ˜˜"),
    ("[å¯æ€œ]", "ðŸ˜»"),
    ("[Whimper]", "ðŸ˜»"),
    ("[èœåˆ€]", "ðŸ”ª"),
    ("[Cleaver]", "ðŸ”ª"),
    ("[è¥¿ç“œ]", "ðŸ‰"),
    ("[Melon]", "ðŸ‰"),
    ("[å•¤é…’]", "ðŸº"),
    ("[Beer]", "ðŸº"),
    ("[å’–å•¡]", "â˜•"),
    ("[Coffee]", "â˜•"),
    ("[çŒªå¤´]", "ðŸ·"),
    ("[Pig]", "ðŸ·"),
    ("[çŽ«ç‘°]", "ðŸŒ¹"),
    ("[Rose]", "ðŸŒ¹"),
    ("[å‡‹è°¢]", "ðŸ¥€"),
    ("[Wilt]", "ðŸ¥€"),
    ("[å˜´å”‡]", "ðŸ’‹"),
    ("[Lip]", "ðŸ’‹"),
    ("[çˆ±å¿ƒ]", "â¤ï¸"),
    ("[Heart]", "â¤ï¸"),
    ("[å¿ƒç¢Ž]", "ðŸ’”"),
    ("[BrokenHeart]", "ðŸ’”"),
    ("[è›‹ç³•]", "ðŸŽ‚"),
    ("[Cake]", "ðŸŽ‚"),
    ("[ç‚¸å¼¹]", "ðŸ’£"),
    ("[Bomb]", "ðŸ’£"),
    ("[ä¾¿ä¾¿]", "ðŸ’©"),
    ("[Poop]", "ðŸ’©"),
    ("[æœˆäº®]", "ðŸŒƒ"),
    ("[Moon]", "ðŸŒƒ"),
    ("[å¤ªé˜³]", "ðŸŒž"),
    ("[Sun]", "ðŸŒž"),
    ("[æ‹¥æŠ±]", "ðŸ¤—"),
    ("[Hug]", "ðŸ¤—"),
    ("[å¼º]", "ðŸ‘"),
    ("[Strong]", "ðŸ‘"),
    ("[å¼±]", "ðŸ‘Ž"),
    ("[Weak]", "ðŸ‘Ž"),
    ("[æ¡æ‰‹]", "ðŸ¤"),
    ("[Shake]", "ðŸ¤"),
    ("[èƒœåˆ©]", "âœŒï¸"),
    ("[Victory]", "âœŒï¸"),
    ("[æŠ±æ‹³]", "ðŸ™"),
    ("[Salute]", "ðŸ™"),
    ("[å‹¾å¼•]", "ðŸ’â™‚"),
    ("[Beckon]", "ðŸ’â™‚"),
    ("[æ‹³å¤´]", "ðŸ‘Š"),
    ("[Fist]", "ðŸ‘Š"),
    ("[OK]", "ðŸ‘Œ"),
    ("[è·³è·³]", "ðŸ’ƒ"),
    ("[Waddle]", "ðŸ’ƒ"),
    ("[å‘æŠ–]", "ðŸ™‡"),
    ("[Tremble]", "ðŸ™‡"),
    ("[æ€„ç«]", "ðŸ˜¡"),
    ("[Aaagh!]", "ðŸ˜¡"),
    ("[è½¬åœˆ]", "ðŸ•º"),
    ("[Twirl]", "ðŸ•º"),
    ("[å˜¿å“ˆ]", "ðŸ¤£"),
    ("[Hey]", "ðŸ¤£"),
    ("[æ‚è„¸]", "ðŸ¤¦â™‚"),
    ("[Facepalm]", "ðŸ¤¦â™‚"),
    ("[å¥¸ç¬‘]", "ðŸ˜œ"),
    ("[Smirk]", "ðŸ˜œ"),
    ("[æœºæ™º]", "ðŸ¤“"),
    ("[Smart]", "ðŸ¤“"),
    ("[çš±çœ‰]", "ðŸ˜Ÿ"),
    ("[Concerned]", "ðŸ˜Ÿ"),
    ("[è€¶]", "âœŒï¸"),
    ("[Yeah!]", "âœŒï¸"),
    ("[çº¢åŒ…]", "ðŸ§§"),
    ("[Packet]", "ðŸ§§"),
    ("[é¸¡]", "ðŸ¥"),
    ("[Chick]", "ðŸ¥"),
    ("[èœ¡çƒ›]", "ðŸ•¯ï¸"),
    ("[Candle]", "ðŸ•¯ï¸"),
    ("[ç³—å¤§äº†]", "ðŸ˜¥"),
    ("[ThumbsUp]", "ðŸ‘"),
    ("[ThumbsDown]", "ðŸ‘Ž"),
    ("[Peace]", "âœŒï¸"),
    ("[Pleased]", "ðŸ˜Š"),
    ("[Rich]", "ðŸ€…"),
    ("[Pup]", "ðŸ¶"),
    ("[åƒç“œ]", "ðŸ™„ðŸ‰"),
    ("[Onlooker]", "ðŸ™„ðŸ‰"),
    ("[åŠ æ²¹]", "ðŸ’ªðŸ˜"),
    ("[GoForIt]", "ðŸ’ªðŸ˜"),
    ("[åŠ æ²¹åŠ æ²¹]", "ðŸ’ªðŸ˜·"),
    ("[æ±—]", "ðŸ˜“"),
    ("[Sweats]", "ðŸ˜“"),
    ("[å¤©å•Š]", "ðŸ˜±"),
    ("[OMG]", "ðŸ˜±"),
    ("[Emm]", "ðŸ¤”"),
    ("[ç¤¾ä¼šç¤¾ä¼š]", "ðŸ˜"),
    ("[Respect]", "ðŸ˜"),
    ("[æ—ºæŸ´]", "ðŸ¶ðŸ˜"),
    ("[Doge]", "ðŸ¶ðŸ˜"),
    ("[å¥½çš„]", "ðŸ˜ðŸ‘Œ"),
    ("[NoProb]", "ðŸ˜ðŸ‘Œ"),
    ("[å“‡]", "ðŸ¤©"),
    ("[Wow]", "ðŸ¤©"),
    ("[æ‰“è„¸]", "ðŸ˜ŸðŸ¤š"),
    ("[MyBad]", "ðŸ˜ŸðŸ¤š"),
    ("[ç ´æ¶•ä¸ºç¬‘]", "ðŸ˜‚"),
    ("[ç ´æ¶•ç‚ºç¬‘]", "ðŸ˜‚"),
    ("[Lol]", "ðŸ˜‚"),
    ("[è‹¦æ¶©]", "ðŸ˜­"),
    ("[Hurt]", "ðŸ˜­"),
    ("[ç¿»ç™½çœ¼]", "ðŸ™„"),
    ("[Boring]", "ðŸ™„"),
    ("[è£‚å¼€]", "ðŸ« "),
    ("[Broken]", "ðŸ« "),
    ("[çˆ†ç«¹]", "ðŸ§¨"),
    ("[Firecracker]", "ðŸ§¨"),
    ("[çƒŸèŠ±]", "ðŸŽ†"),
    ("[Fireworks]", "ðŸŽ†"),
    ("[ç¦]", "ðŸ§§"),
    ("[Blessing]", "ðŸ§§"),
    ("[ç¤¼ç‰©]", "ðŸŽ"),
    ("[Gift]", "ðŸŽ"),
    ("[åº†ç¥]", "ðŸŽ‰"),
    ("[Party]", "ðŸŽ‰"),
    ("[åˆå]", "ðŸ™"),
    ("[Worship]", "ðŸ™"),
    ("[å¹æ°”]", "ðŸ˜®ðŸ’¨"),
    ("[Sigh]", "ðŸ˜®ðŸ’¨"),
    ("[è®©æˆ‘çœ‹çœ‹]", "ðŸ‘€"),
    ("[LetMeSee]", "ðŸ‘€"),
    ("[666]", "6ï¸âƒ£6ï¸âƒ£6ï¸âƒ£"),
    ("[æ— è¯­]", "ðŸ˜‘"),
    ("[Duh]", "ðŸ˜‘"),
    ("[å¤±æœ›]", "ðŸ˜ž"),
    ("[Let Down]", "ðŸ˜ž"),
    ("[ææƒ§]", "ðŸ˜¨"),
    ("[Terror]", "ðŸ˜¨"),
    ("[è„¸çº¢]", "ðŸ˜³"),
    ("[Flushed]", "ðŸ˜³"),
    ("[ç”Ÿç—…]", "ðŸ˜·"),
    ("[Sick]", "ðŸ˜·"),
    ("[ç¬‘è„¸]", "ðŸ˜"),
    ("[Happy]", "ðŸ˜"),
];

pub fn replace_qq_face(id: &str) -> String {
    QQ_EMOJI
        .get(id)
        .map(|v| format!("/{}", v))
        .unwrap_or_else(|| format!("/[Face{}]", id))
}

pub fn replace_wechat_emoji(content: &str) -> String {
    let mut result = content.to_string();
    for &(old, new) in WECHAT_EMOJI_REPLACEMENTS {
        result = result.replace(old, new);
    }
    result
}
